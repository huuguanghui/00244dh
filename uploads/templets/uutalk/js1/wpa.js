if(!window.BQQWPALOAD){(function(ar,t){var X="0",ay="1",n="2",x="4",C="20",g="0",Q="1",aj="2",V="0",F="1",D="0",S="1",L="2",ap="0",p="1",Y="2",al="0",j="1";var k=2000,z=1000,K=2000,aw=2000,c=5000,v=15000,Z=3600000,m=1000;var ag="kfu",l="pgv_pvi";var ab="is",M="ik",U="msg",an="mh",W="mid",aC="slid";var ad="0",b="1",aB="2",O="0",az="-1",ah="|";var a="http://visitor.crm2.qq.com/cgi/visitorcgi/ajax/wpa_first_heart_beat.php",T="http://visitor.crm2.qq.com/cgi/visitorcgi/ajax/wpa_heart_beat.php",B="http://visitor.crm2.qq.com/cgi/visitorcgi/ajax/auto_invite.php";var ai=0,d="0",q="1",r="2",aA=1;var aq=3000,aa=120;var aD="",au="qq.com,pengyou.com,qzoneapp.com,nipic.com,docin.com,51zxw.net,2155.com,xd.com,yto.net.cn,c-c.com,27.cn,05wan.com,alivv.cn,gogo.com,doctorjob.com.cn,emoney.cn,m4.cn,chinaktv.net,yk988.com,bangkaow.com,wsxsp.com,55tools.com,youxi518.com",ac=1,o="b.qq.com,sales.b.qq.com,guilin.house.qq.com,ta.qq.com,hn.qq.com,nantong.house.qq.com";var I=ar.document;var av=function(){return +new Date()};var f=function(aG){aG+=aG.indexOf("?")>-1?"":"?";aG+="&"+av();var aF="log_"+av(),aE=ar[aF]=new Image();aE.onload=aE.onerror=function(){ar[aF]=null};aE.src=aG;aE=null};var af;(function(){af=function(aF,aE,aG){this.url="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1="+aF+"&flag2="+aE+"&flag3="+aG+"&";this.p0=av();this.points=[this.p0]};af.prototype={addPoint:function(aE,aH){var aG=this.points;if(aE>=aG.length){for(var aF=aG.length;aF<aE;aF++){aG.push(0)}}aH=aH||(av()-this.p0);aG[aE]=aH;return this},pushPoint:function(aE){aE=aE||(av()-this.p0);this.points.push(aE);return this},send:function(){var aF=this.url,aH=this.points;for(var aG=1,aE=aH.length;aG<aE;aG++){if(aH[aG]){aF+=aG+"="+aH[aG]+"&"}}f(aF);return this}}})();var G=new af("7818","4","1");var w=/^https/.test(ar.location.href);var i=function(){var aH=ar.document.domain,aF=/\.((edu)|(gov)|(com)|(org)|(net))\.cn$/,aE=/^[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d$/,aG=aF.test(aH)?-3:aE.test(aH)?0:-2;return aH.split(".").slice(aG).join(".")}();var at=function(){var aF=i,aE=/^[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d$/,aG=/^localhost$/;return aD.indexOf(aF)===-1&&!aE.test(aF)&&!aG.test(aF)}();var A=function(){try{var aG=/^http[s]?:[\/]{2,3}([^\/$]+)/.exec(location.href)[1];var aF=new RegExp("(^|,)"+aG);if(aF.test(o)){return true}var aE=i,aI=new RegExp("(^|,)"+i);IPReg=/^[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d\.[12]?\d?\d$/,LocalReg=/^localhost$/;return !aI.test(au)&&!IPReg.test(aE)&&!LocalReg.test(aE)}catch(aH){}}();var ax=/(msie|MSIE)/.test(ar.navigator.userAgent);var u=function(aF,aE){return function(){aE.apply(aF,arguments)}};var E={log:ar.console?function(aE){}:function(){}};var J=function(aE){return aE.addEventListener?function(aH,aF,aG){aH.addEventListener(aF,aG)}:function(aH,aF,aG){aH.attachEvent("on"+aF,aG)}}(ar);var ak=function(aE){if(I.readyState==="complete"){ak=function(aF){aF()};aE()}else{J(ar,"load",aE)}};var ao=function(aG,aI,aK){var aF=I.createElement("script"),aJ=I.getElementsByTagName("head")[0];setTimeout(function(){if(!aJ){setTimeout(arguments.callee,0)}else{aJ.insertBefore(aF,aJ.firstChild)}},0);var aE="JSONP_CALLBACK_"+av();ar[aE]=function(){aK&&aK.apply(ar,arguments);(function(){try{aJ.removeChild(aF);ar[aE]=t}catch(aM){E.log(aM);setTimeout(arguments.callee,0)}})()};aI=aI||{};aI.cb=aE;var aL="";for(var aH in aI){if(aI[aH]&&aI.hasOwnProperty(aH)){aL+=aH+"="+encodeURIComponent(aI[aH])+"&"}}aG+=(aG.indexOf("?")>-1?"&":"?")+aL;aF.async=true;aF.src=aG};var R;(function(){R={set:function(aF,aH,aG,aJ,aE){if(aE){aE=new Date(av()+aE)}var aI=aF+"="+escape(aH)+((aE)?"; expires="+aE.toGMTString():"")+((aJ)?"; path="+aJ:"")+((aG)?"; domain="+aG:"");if(aI.length<4096){ar.document.cookie=aI}},get:function(aF){var aE=ar.document.cookie.match(new RegExp("(^| )"+aF+"=([^;]*)(;|$)"));if(aE!=null){return unescape(aE[2])}return null},del:function(aE,aF,aG){if(this.get(aE)){ar.document.cookie=aE+"="+((aG)?"; path="+aG:"")+((aF)?"; domain="+aF:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT"}},find:function(aE){return ar.document.cookie.match(aE).split(",")}}})();var h;(function(){var aE=R;h=function(aF){this.blockIndex=aF};h.get=function(aF){return aE.get(aF)};h.set=function(aF,aG){return aE.set(aF,aG,i)};h.del=function(aF){return aE.del(aF,i)};h.find=function(){return aE.find.apply(aE,arguments)};h.prototype={set:function(aF,aG){return aE.set(this.blockIndex+aF,aG,i)},get:function(aF){return aE.get(this.blockIndex+aF)},del:function(aF){return aE.del(this.blockIndex+aF,i)},find:function(aJ){var aI=aE.find(new RegExp(this.blockIndex+"[^=]*")),aH=aI.join(";").replace(new RegExp(this.blockIndex,"g"),"").split(";");for(var aG=0,aK,aF=[];aK=aH[aG++];){if(aJ.test&&aJ.test(aK)){aF.push(aK);continue}if(aK.indexOf(aJ)>-1){aF.push(aK)}}return aF}}})();var y;(function(){y={add:function(aF){var aE=I.createElement("script");aE.src=aF;I.getElementsByTagName("head")[0].appendChild(aE)}}})();var P;(function(){P=function(){this.hash={};this.count=0;this.id=0};P.prototype={add:function(aF){var aE={data:aF,index:++this.id};this.hash[aE.index]=aE;if(this.count===0){this.first=this.last=this.cursor=aE.pre=aE.next=aE;this.count=1;return aE}aE.pre=this.last;aE.next=this.first;this.last.next=this.first.pre=aE;this.last=aE;this.count++},remove:function(aE){if(!this.hash[aE]||this.count===0){return false}if(this.count===1){this.hash[aE]=t;this.first=this.last=this.cursor=t;this.count=0;return true}var aF=this.hash[aE];if(aF===this.first){this.first=aF.next}if(aF===this.last){this.last=aF.pre}this.cursor=aF.next;aF.pre.next=aF.next;aF.next.pre=aF.pre;aF=this.hash[aE]=t;this.count--;return true},removeCurrentElem:function(){return this.cursor&&this.remove(this.cursor.index)},pre:function(){return this.cursor=this.cursor.pre},next:function(){return this.cursor=this.cursor.next},getElem:function(aE){return this.hash[aE]},getCurrentElem:function(){return this.cursor},getLength:function(){return this.count}}})();var s;(function(){var aJ="run",aI="pause",aG="drop",aF=50;var aE=function(){this.circle=new P();setInterval(u(this,this.loop),16)};aE.prototype={newTask:function(aL,aM){var aK=new aH(aL,aM);this.circle.add(aK);return aK},loop:function(){var aO=this.circle,aK=aO.getLength();if(aK>0){var aN=av(),aM=aF*1000,aL;while(aK>0&&av()-aN<aM){aL=aO.getCurrentElem().data;if(aL.status===aJ){aL.execute();aO.next()}else{if(aL.status===aI){aO.next()}else{if(aL.status===aG){aO.removeCurrentElem()}}}aK--}}}};var aH=function(aK,aL){this.fn=aK;this.gap=aL;this.status=aI;this.lastExecTime=av()};aH.prototype={run:function(){this.status=aJ;return this},pause:function(){this.status=aI;return this},drop:function(){this.status=aG;return this},execute:function(){if(av()-this.lastExecTime<this.gap){return false}this.fn();this.lastExecTime=av();return true},getGap:function(){return this.gap},setGap:function(aK){this.gap=aK;return this}};s=new aE()})();var N;(function(aE){var aG=aE.title,aF=s.newTask(function(){var aH=aE.title;aE.title=aH.substr(1,aH.length)+aH.substr(0,1)},aa);N={on:function(aH){aE.title=aH+(""+aE.title);aF.run()},off:function(){aF.pause();aE.title=aG}}})(I);var am;(function(){var aF={};am={newWPA:function(aI){var aG=aI.kfuin;if(!aG){return false}var aJ=new af("7818","4","1");aI._=av();var aH=new aE(aI);if(!aI.wid){aH.iframe.onload=function(){aJ.addPoint(2).send()}}aF[aG]?aF[aG].push(aH):aF[aG]=[aH];return aH},findInPage:function(aG){return aF[aG]!==t},getParams:function(){var aL=ar.document;var aJ=aL.getElementsByTagName("script");if(!aJ.length||aJ.length<1){return false}aJ=aJ[aJ.length-1];var aN=aJ.src.substring(aJ.src.indexOf("?")+1,aJ.src.length),aH=decodeURIComponent(aN).split("&"),aM={};for(var aI=0,aK,aG;aK=aH[aI++];){aG=aK.split("=");aM[aG[0]]=aG[1]}aM.referrer=aL.referrer.length>500?aL.referrer.substr(0,500):aL.referrer;aM.cref=ar.location.href.length>500?ar.location.href.substr(0,500):ar.location.href;aM.pt=aL.title.length>500?aL.title.substr(0,500):aL.title;if(aM.aty==="1"){aM.kfext=aM.a}aM.kfext=aM.kfext||"";aM.dm=i;return aM},getWPAs:function(aG){return aF[aG]||[]},invite:function(aH,aJ){if(!aH){N.on("\u3010\u60A8\u6709\u65B0\u4FE1\u606F\u3011");am.newWPA(aJ);return}var aG=function(aK){return function(){var aM=encodeURIComponent(aK.kfuin),aR=encodeURIComponent(aK.ws),aS=encodeURIComponent(aK.referrer),aO=encodeURIComponent(aK.cref),aQ=encodeURIComponent(aK.dm),aV=encodeURIComponent(aK.pt),aP=aK.aty||"",aT=aK.a||"",aN=aK.iv||"",aU=aK.sv||"0",aL=aK.sp||"";ar.open("http://crm2.qq.com/page/portalpage/wpa.php?uin="+aM+"&cref="+aO+"&ref="+aS+"&dm="+aQ+"&pt="+aV+"&f=1&ty=1&ap=&as=&aty="+aP+"&a="+aT+"&iv="+aN+"&sv="+aU+"&sp="+aL,"_blank","height=544, width=644,toolbar=no,scrollbars=no,menubar=no,status=no");f("http://promreport.crm2.qq.com/wpa/r.gif?type=3&kfuin="+aM+"&dm="+i+"&t="+Math.round(av()/3600))}}(aJ);try{ar[aH]&&ar[aH](aG,aJ.msg)}catch(aI){am.newWPA(aJ)}}};var aE=function(aG){this.params=aG;this.kfuin=aG.kfuin;this.wty=aG.wty||ay;if(this.wty!==ay){return false}this.createView()};aE.prototype={createView:function(){var aL=this.params,aR=aL.wid;if(aR){var aJ=I.getElementById(aR),aK=u(this,function(aS){this.wElem=aS;this.createDefinedWPA()});if(aJ){aK(aJ)}else{ak(u(this,function(){var aS=I.getElementById(aR);if(aS){aK(aS)}}))}return}var aH,aP,aO=this.serialize(aL),aN=parseInt(aL.type),aQ=w?"https://id.b.qq.com/static/account/bizqq/wpa/":"http://cdn.b.qq.com/account/bizqq/wpa/",aM,aI=false;switch(aN){case 1:aM="a01";aH=102;aP=24;break;case 2:aM="a02";aH=102;aP=24;break;case 3:aM="a03";aH=84;aP=24;break;case 4:aM="a04";aH=120;aP=40;break;case 5:aM="a05";aH=126;aP=42;break;case 6:aM="a06";aH=126;aP=42;break;case 7:aM="a07";aH=174;aP=80;break;case 8:aM="a08";aH=174;aP=80;break;case 9:aM="a09";aH=230;aP=92;break;case 10:aM="b01";aH=106;aP=164;aI=true;break;case 11:aM="b02";aH=346;aP=164;aI=true;break;case 12:aM="b03";aH=404;aP=200;aI=true;break;case 13:aM="b04";aH=138;aP=320;aI=true;break;case 20:aM="i01";aH=368;aP=192;aI=true;break;case 30:aM="w01";aH=25;aP=25;break;case 31:aM="w02";aH=102;aP=24;break;case 14:aM="c01";break}this.url=aQ+"wpa_"+aM+".html?"+aO;this.width=aH;this.height=aP;if(aI){this.createFloatWPA()}else{var aG=aL.containerid;this.createStaticWPA(aG)}},createStaticWPA:function(aH){var aK,aI=this.url,aJ=this.width,aG=this.height;if(typeof aH==="string"&&I.getElementById(aH)){if(ar.ActiveXObject){aK=I.createElement('<iframe scrolling="no" frameborder="0" width="'+aJ+'" height="'+aG+'" allowtransparency="true" src="'+aI+'"></iframe>')}else{aK=I.createElement("iframe");aK.setAttribute("scrolling","no");aK.setAttribute("frameborder",0);aK.setAttribute("width",aJ);aK.setAttribute("height",aG);aK.style.borderWidth="0";aK.setAttribute("allowtransparency",true);aK.setAttribute("src",aI)}I.getElementById(aH).appendChild(aK);this.iframe=aK}else{var aL="iframediv"+av();I.write('<iframe id="'+aL+'" scrolling="no" frameborder="0" width="'+aJ+'" height="'+aG+'" allowtransparency="true" src="'+aI+'"></iframe>');this.iframe=ar.document.getElementById(aL)}},createFloatWPA:function(){var aQ=ar.document,aL=this.params,aN=parseInt(aL.type),aG=aQ.createElement("div"),aH=this.url,aI=this.width,aR=this.height;aG.style.cssText=["display:none;","position:absolute;","z-index:2147483647!important;","width:"+aI+"px!important;","height:"+aR+"px!important;"].join(" ");var aM=aQ.createElement("iframe");aM.id="__WPA_Iframe__";aM.frameBorder=0;aM.scrolling="no";aM.allowTransparency="true";aM.border=0;aM.width=aI;aM.height=aR;aM.src=aH;this.iframe=aM;aG.appendChild(aM);ak(aK);function aK(){var aX=aG.style,aW=ar.ActiveXObject?true:false,aT=aW?9-((navigator.userAgent.indexOf("Trident/5.0")>-1)?0:1)-(ar.XDomainRequest?0:1)-(ar.XMLHttpRequest?0:1):"",aY=aQ.compatMode==="BackCompat";aX.position=parseInt(aL.fsty)==0?"fixed":"absolute";if(parseInt(aL.fposX)==0){aX.left=8+"px";aX.right="auto";aX.marginLeft=0}else{if(parseInt(aL.fposX)==1){aX.left="50%";aX.right="auto";aX.marginLeft="-"+parseInt(aI/2)+"px"}else{aX.left="auto";aX.right=8+"px";aX.marginLeft=0}}if(parseInt(aL.fposY)==0){aX.top=8+"px";aX.bottom="auto";aX.marginTop=0}else{if(parseInt(aL.fposY)==1){aX.top="50%";aX.bottom="auto";aX.marginTop="-"+parseInt(aR/2)+"px"}else{aX.top="auto";aX.bottom=8+"px";aX.marginTop=0}}if((aW&aT<7)||aY){aX.position="absolute";if(parseInt(aL.fsty)==0){aX.marginTop=0;var aU;if(parseInt(aL.fposY)==0){aU=8}else{if(parseInt(aL.fposY)==1){aU=(aS(aQ)-aR)/2}else{aU=aS(aQ)-aR-8}}setInterval(function(){aX.top=aV(aQ)+aU+"px"},128)}}aX.display="block";function aV(aZ){return Math.max(aZ.documentElement.scrollTop,aZ.body.scrollTop)}function aS(aZ){return aZ.compatMode=="CSS1Compat"?aZ.documentElement.clientHeight:aZ.body.clientHeight}}var aO=aQ.createElement("div");aO.style.backgroundColor="#ffffff";aO.style.filter="alpha(opacity=0)";aO.style.opacity=0;aO.id="__WPA_CLOSEBTN__";aO.style.display="block";aO.style.width=39+"px";aO.style.height=18+"px";aO.style.position="absolute";aO.style.top=(aN===20?0:6)+"px";aO.style.right=(aN===20?6:10)+"px";aO.style.cursor="pointer";aO.onclick=function(){aG.parentNode.removeChild(aG)};aG.appendChild(aO);if(aN===20){var aJ=aQ.createElement("div");aJ.style.backgroundColor="#ffffff";aJ.style.filter="alpha(opacity=0)";aJ.style.opacity=0;aJ.id="__WPA_CHATBTN__";aJ.style.display="block";aJ.style.width=109+"px";aJ.style.height=33+"px";aJ.style.position="absolute";aJ.style.top=142+"px";aJ.style.left=244+"px";aJ.style.cursor="pointer";aJ.onclick=function(){aG.parentNode.removeChild(aG);var aT=encodeURIComponent(aL.kfuin),aY=encodeURIComponent(aL.ws),aZ=encodeURIComponent(aL.referrer),aV=encodeURIComponent(aL.cref),aX=encodeURIComponent(aL.dm),a2=encodeURIComponent(aL.pt),aW=aL.aty||"",a0=aL.a||"",aU=aL.iv||"",a1=aL.sv||"0",aS=aL.sp||"";ar.open("http://crm2.qq.com/page/portalpage/wpa.php?uin="+aT+"&cref="+aV+"&ref="+aZ+"&dm="+aX+"&pt="+a2+"&f=1&ty=1&ap=&as=&aty="+aW+"&a="+a0+"&iv="+aU+"&sv="+a1+"&sp="+aS,"_blank","height=544, width=644,toolbar=no,scrollbars=no,menubar=no,status=no");N.off();f("http://promreport.crm2.qq.com/wpa/r.gif?type=2&kfuin="+aT+"&dm="+i+"&t="+Math.round(av()/3600))};aG.appendChild(aJ);aO.onclick=function(){aG.parentNode.removeChild(aG);N.off()}}if(aN==11||aN==12){var aP=aQ.createElement("div");aP.style.display="block";aP.style.backgroundColor="#ffffff";aP.style.filter="alpha(opacity=0)";aP.style.opacity=0;aP.style.width=70+"px";aP.style.height=21+"px";aP.style.position="absolute";if(parseInt(aL.type)==11){aP.style.bottom=11+"px";aP.style.right=12+"px"}if(parseInt(aL.type)==12){aP.style.bottom=16+"px";aP.style.right=16+"px"}aP.style.cursor="pointer";aP.onclick=function(){aG.parentNode.removeChild(aG)};aG.appendChild(aP)}setTimeout(function(){if(!I.body){setTimeout(arguments.callee,0)}else{I.body.insertBefore(aG,I.body.firstChild)}},1)},createDefinedWPA:function(){var aG=this.params;J(this.wElem,"click",function(){var aI=aG.kfuin,aN=aG.ws,aO=aG.referrer,aK=aG.cref,aR=aG.pt,aP=aG.a||"",aL=aG.aty||"",aM=aG.dm,aQ=aG.sv||"",aH=aG.sp||"",aJ=aG.btn1;ar.open("http://crm2.qq.com/page/portalpage/wpa.php?uin="+aI+"&cref="+aK+"&ref="+aO+"&pt="+aR+"&f=1&ty=1&ap=&as=&aty="+aL+"&a="+aP+"&dm="+aM+"&sv="+aQ+"&sp="+aH||this.wElem.pvid,"_blank","height=544, width=644,toolbar=no,scrollbars=no,menubar=no,status=no")})},resetViewWithPvid:function(aG){this.params.sp=aG;if(this.wElem){return}this.iframe.src=this.url+(/&$/.test(this.url)?"":"&")+"sp="+aG+"&reset=1"},serialize:function(aH){var aI="";for(var aG in aH){if(aH.hasOwnProperty(aG)){aI+=aG+"="+encodeURIComponent(aH[aG])+"&"}}return aI}}})();var H;(function(){H=function(aE,aG,aF){this.kfuin=aE;this.pvid=aG;this.config=aF;this.genID();this.storage=new h(aE);this.monitors={master:s.newTask(u(this,this.masterMonitor),k).run(),invite:s.newTask(u(this,this.inviteMonitor),z).run()};this.heartBeat=s.newTask(u(this,this.heartBeatProcess),aw).run();this.setActive();ar.onfocus=u(this,this.setActive);E.log("slave "+this.id+" launched!")};H.prototype={genID:function(){this.id="slid_"+av()%1000+"_"+Math.round(Math.random()*100)},masterMonitor:function(){if(ae[this.kfuin]){return false}E.log("monitoring mater state");var aE=this.storage.get(an)||0,aF=av()-parseInt(aE);E.log("gap of master is "+aF);if(aF>3*K){this.recoverMaster()}},recoverMaster:function(){ae[this.kfuin]=new e(this.kfuin,this.pvid,this.config);E.log("recover master by slave "+this.id)},inviteMonitor:function(){if(this.isInvited()){this.kill()}else{if(this.isInviting()){if(this.isActive()){this.invite()}}}E.log("slave "+this.id+" monitoring invite state")},kill:function(){this.monitors.invite.drop();this.heartBeat.drop();var aH=this.storage,aG=[this.id];for(var aF=0,aE;aE=aG[aF++];){aH.del(aE)}E.log("slave "+this.id+" killed")},invite:function(){var aE=this.storage.get(M);var aF={wty:ay,kfuin:this.kfuin,type:C,aty:aE?(aE===O?g:Q):"",a:aE||"",iv:j,fsty:V,fposX:S,fposY:p,sv:x,sp:this.pvid,dm:i,msg:this.storage.get(U)};am.invite(this.config.di,aF);this.storage.set(ab,aB);E.log("invited by slave "+this.id)},heartBeatProcess:function(){var aF=this.storage,aE=aF.get(aC);if(!aE){aF.set(aC,this.id+"|")}else{if(aE.indexOf(this.id+"|")===-1){aF.set(aC,this.id+"|"+aE)}}aF.set(this.id,av())},setActive:function(){var aG=this.storage,aF=aG.get(aC)||"",aE=this.id+ah;if(aF.indexOf(this.id)>-1){aF=aF.replace(aE,"")}aF+=aE;aG.set(aC,aF)},isActive:function(){var aE=this.storage.get(aC);if(!aE){return false}return aE.substr(0,aE.length-1).split(ah).pop()===this.id},isInvited:function(){return this.storage.get(ab)===aB},isInviting:function(){return this.storage.get(ab)===b}}})();var e;(function(){e=function(aE,aG,aF){this.kfuin=aE;this.pvid=aG;this.config=aF;this.storage=new h(aE);this.genID();this.sleep=false;this.storage.set(W,this.id);this.heartBeatProcess();this.heartBeat=s.newTask(u(this,this.heartBeatProcess),K).run();this.initWithConfig();E.log("master launched!")};e.prototype={genID:function(){this.id=av()%1000+"_"+Math.round(Math.random()*100)},setInviteState:function(aF,aE,aG){if(aF===b){this.storage.set(M,aE);this.storage.set(U,aG)}this.storage.set(ab,aF)},isInvited:function(){var aE=this.storage.get(ab)===aB;if(aE){this.recycle();this.isInvited=function(){return true}}return aE},initWithConfig:function(){var aE=this.config;if(aE.r!==ai){this.storage.set(an,az);return false}if(aE.isAuto===aA){this.storage.set(U,aE.autoMsg);this.autoInviteTimer=setTimeout(u(this,function(){this.autoInvite()}),aE.autoTime*1000)}this.monitors={slave:s.newTask(u(this,this.slaveMonitor),aw).run(),server:s.newTask(u(this,this.serverMonitor),c).run(),sleep:s.newTask(u(this,this.sleepMonitor),Z).run()};E.log("master inited with config")},autoInvite:function(){if(this.isInvited()){return false}var aE={kfuin:this.kfuin,uid:this.pvid},aF=this;ao(B,aE,u(this,function(aG){if(aG.r!==ai){return false}if(!aF.isInvited()){this.setInviteState(b,O,this.storage.get(U))}}))},ajustServerMonitorGap:function(aE){this.monitors.server.setGap(Math.min(Math.max(c,aE),v))},serverMonitor:function(){var aG=this.storage.get(ab),aE=this.config.hbDomain?decodeURIComponent(this.config.hbDomain):T;if(this.sleep){return false}var aF={kfuin:this.kfuin,uid:this.pvid};if(aG===b){aF.inviteState=q}if(aG===aB){aF.inviteState=r}ao(aE,aF,u(this,function(aH){if(aH.r!==ai){return false}if(aH.gap){this.ajustServerMonitorGap(aH.gap*1000)}if(aH.inviteState===d){return false}if(aH.inviteState===q){this.setInviteState(b,aH.kfext,aH.inviteMsg);return false}if(aH.inviteState===r){this.setInviteState(aB)}}));E.log(this.kfuin+" is monitoring server")},slaveMonitor:function(){if(this.isInvited()){this.monitors.slave.drop()}var aL=this.storage,aE=aL.get(aC);if(!aE){return false}aE=aE.split(ah);var aJ="",aI=av(),aH,aF,aK;for(var aG=0;aF=aE[aG++];){E.log("monitoring slave "+aF+" state");aH=aL.get(aF)||0;aK=aI-parseInt(aH);E.log("gap of slave "+aF+" is "+aK);if(aK>3*aw){aL.del(aF);E.log("clear slave "+aF+" in storage")}else{aJ+=aF+ah}}aL.set(aC,aJ)},sleepMonitor:function(){var aE=this.storage.get(aC),aF=aE.substr(0,aE.length-1).split(ah).pop();if(this.sleep){if(this.activeSlave!==aF){this.activeSlave=aF;this.sleep=false;this.monitors.sleep.setGap(Z)}}else{if(this.activeSlave===aF){this.sleep=true;this.monitors.sleep.setGap(m)}else{this.activeSlave=aF}}},kill:function(){ae[this.kfuin]=t;this.monitors.server.drop();this.monitors.slave.drop();this.heartBeat.drop();clearTimeout(this.autoInviteTimer);E.log("master killed")},recycle:function(){var aH=this.storage,aG=[M,U];for(var aF=0,aE;aE=aG[aF++];){aH.del(aE)}E.log("storage recycled")},heartBeatProcess:function(){var aE=this.storage;if(aE.get(W)!==this.id){this.kill();return false}this.storage.set(an,av())}}})();var ae={};ar.BQQWPALOAD=function(){var aJ=am.getParams();if(!aJ){return false}var aI=aJ.kfuin;if(!aI||aI==="undefined"){return false}var aN=am.findInPage(aI);aJ.sv=x;if(aJ.wty===ay||!aJ.wty){var aM=am.newWPA(aJ)}if(aN){return}if(at){var aE="http://tajs.qq.com/crmqq.php?uid="+aI+"&dm="+i;ak(function(){y.add(aE)})}var aK=h.get(l),aH=0;var aG=function(aR,aP){E.log(aI+" has lauched process");var aS=am.getWPAs(aI);for(var aQ=0,aO=aS.length;aQ<aO;aQ++){aS[aQ].resetViewWithPvid(aR)}if(aP.block===ac){return false}if(A){E.log(aI+" has started slave");aP.di=aJ.di;new H(aI,aR,aP)}};var aF={kfuin:aI,dm:i,title:I.title,url:ar.location.href.split("://")[1].split("?")[0]};ak(function(){ao(a,aF,function(aO){E.log(aI+" get config from first_heart_beat");if(aK){aG(aK,aO)}else{s.newTask(function(){aK=h.get(l);if(aK){aG(aK,aO);this.drop()}if(aH++>aq){this.drop()}},200).run()}})});var aL=navigator.userAgent.match(/(nokia|iphone|android|motorola|^mot\-|softbank|foma|docomo|kddi|up\.browser|up\.link|htc|dopod|blazer|netfront|helio|hosin|huawei|novarra|CoolPad|webos|techfaith|palmsource|blackberry|alcatel|amoi|ktouch|nexian|samsung|^sam\-|s[cg]h|^lge|ericsson|philips|sagem|wellcom|bunjalloo|maui|symbian|smartphone|midp|wap|phone|windows ce|iemobile|^spice|^bird|^zte\-|longcos|pantech|gionee|^sie\-|portalmmm|jig\s browser|hiptop|^ucweb|^benq|haier|^lct|opera\s*mobi|opera\*mini|320x320|240x320|176x220)/i);f("http://promreport.crm2.qq.com/wpamobile/r.gif?mobile="+(aL?1:0));G.pushPoint().send();(function(){try{var aO=new Date().getTime()%20000;ao("http://wpa.b.qq.com/cgi/wpa.php?key="+aO)}catch(aP){}})()}})(window)}window.BQQWPALOAD();